<!DOCTYPE html>
<html>


<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<head>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" media="screen"
  />
</head>
<body>
  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="/">Whiteboard</a>
        <a class="navbar-brand" href="#"> Excel Sheets </a>
      </div>
      <div class="btn-group">
      </div>
    </div>
  </nav>
  <div class="container">
    <h1> Welcome to Sheets </h1>
    <div class="btn-group">
      <form id="load" action="">
        <input id="m" autocomplete="off" /> <button type="submit" class="btn btn-default"> Load</button>
      </form>
      <form id="row">
        <button type="submit" class="btn btn-default"> New Row</button>
      </form>
      <form id="col">
        <button type="submit" class="btn btn-default"> New Column</button>
      </form>
    </div>
    <table id="spreadsheet"> </table>
    <form id="list" action="">
      <button type="submit" class="btn btn-default">List</button>
    </form>
    <ul id="files_list">
    </ul>
  </div>
</body>


<script>
  var rawsheet;
  var currentCell;
  var rowLength;
  var maxRows;
  var socket = io();
  $('#col').submit(function(){
    console.log("col");
    socket.emit("col", rowLength);
    return false;
  });
  $('#row').submit(function(){
    console.log("row");
    socket.emit('row', rowLength);
    return false;
  });
  $('#load').submit(function(){
    socket.emit('update', $('#m').val(), currentCell);
    return false;
  });
  $('#list').submit(function(){
    socket.emit('list','list' );
    return false;
  });
  socket.on('message',function(msg){
    var tb;
    var tr;
    var row;
    $('#spreadsheet').html("") ;
    rowLength = 0;
    maxRows = msg.length;
    for(var i =0; i<msg.length;++i){
      if(rowLength < msg[i].length) rowLength = msg[i].length;
    }
    for (var i = 0; i < msg.length; ++i){
      tr = $('<tr>');
      row = msg[i];
      for(var j = 0; j < rowLength; ++j){
        if(j > (row.length-1)){
          row[j] = "";
        }
        tr.append("<td><input id="+String(i)+'-'+String(j)+" value="+row[j]+"></td>");
      }
      tr.append("</tr>");
      $('#spreadsheet').append(tr);
    }
    $('#spreadsheet > tbody > tr > td > input').on("click", function(){

      currentCell = $(this).attr('id').split("-");
      $('#m').val(rawsheet[currentCell[0]][currentCell[1]]);
    });
  });
  socket.on('rawsheet', function(msg){
    rawsheet = msg;
  });
  socket.on('list', function(msg){
    var li;
    $('#files_list').html("");
    for(var i = 0; i < msg.length; ++i){
      li = $('<li>');
      li.append("<button id="+msg[i].id+'>'+msg[i].name+'</button>');
      li.append("</li>");
      $('#files_list').append(li);
    }
    $('#files_list > li > button').on( "click", function(){
      socket.emit('change_to_id', $(this).attr('id'));
    });
  });

</script>

</html>